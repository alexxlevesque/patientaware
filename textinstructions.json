{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue;}
{\colortbl;\red255\green255\blue255;\red255\green255\blue255;}
{\*\expandedcolortbl;;\cssrgb\c100000\c100000\c100000;}
\margl1440\margr1440\vieww30040\viewh16320\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \cb2 \expnd0\expndtw0\kerning0
Code block 1\cb1 \
\cb2 const rawJSON = JSON.stringify(items[0].json, null, 2);\cb1 \
\cb2 return [\{ json: \{ raw_dump: rawJSON \} \}];\cb1 \
\
\cb2 Txt file\cb1 \
\
\cb2 Data prep for ai\cb1 \
\cb2 // 1. Get the data from the current input (File Extract)\cb1 \
\cb2 const fileData = $input.first().json.data;\cb1 \
\
\cb2 // 2. Get the content from the HTTP Request\cb1 \
\cb2 const httpContent = $('HTTP Request2').first().json.content;\cb1 \
\
\cb2 // 3. Combine them\cb1 \
\cb2 const combinedPrompt = `\cb1 \
\cb2 Here is the file data:\cb1 \
\cb2 $\{fileData\}\cb1 \
\
\cb2 Here is the additional content:\cb1 \
\cb2 $\{httpContent\}\cb1 \
\cb2 `;\cb1 \
\
\cb2 // 4. Return\cb1 \
\cb2 return \{\cb1 \
\cb2 \'a0 json: \{\cb1 \
\cb2 \'a0 \'a0 combined_prompt: combinedPrompt\cb1 \
\cb2 \'a0 \}\cb1 \
\cb2 \};\cb1 \
\
\
\
\
\cb2 Cleaning for backboard\cb1 \
\cb2 // 1. Get Backboard Data (Assumed to be on Input 1 / Index 0)\cb1 \
\cb2 const backboardData = items[0].json;\cb1 \
\
\cb2 // 2. Get RapidAPI Data (Assumed to be on Input 2 / Index 1)\cb1 \
\cb2 // We use optional chaining (?.) so this doesn't crash if RapidAPI is disconnected or fails\cb1 \
\cb2 const rapidData = items[1]?.json; // This might be undefined during your test\cb1 \
\
\cb2 // 3. Construct the output text\cb1 \
\cb2 // If RapidAPI is missing, we just say "Not available for this test."\cb1 \
\cb2 const rapidResult = rapidData ? JSON.stringify(rapidData).substring(0, 200) + "..." : "(RapidAPI Disabled for Testing)";\cb1 \
\
\cb2 const finalReport = `\cb1 \
\cb2 *** BACKBOARD ANALYSIS ***\cb1 \
\cb2 $\{backboardData.formatted_text || backboardData.combined_prompt || "No Backboard Output"\}\cb1 \
\
\cb2 ---------------------------------------------------\cb1 \
\
\cb2 *** SECOND OPINION (RAPID API) ***\cb1 \
\cb2 $\{rapidResult\}\cb1 \
\cb2 `;\cb1 \
\
\cb2 return [\cb1 \
\cb2 \'a0 \{\cb1 \
\cb2 \'a0 \'a0 json: \{\cb1 \
\cb2 \'a0 \'a0 \'a0 final_report: finalReport,\cb1 \
\cb2 \'a0 \'a0 \'a0 ...backboardData // Keep original data available\cb1 \
\cb2 \'a0 \'a0 \}\cb1 \
\cb2 \'a0 \}\cb1 \
\cb2 ];\cb1 \
\
\
\
\cb2 Then workflow links to backboard\cb1 \
\
\cb2 Cleaning for email\cb1 \
\cb2 // 1. Get the raw content from the Backboard output\cb1 \
\cb2 const rawText = items[0].json.content;\cb1 \
\
\cb2 if (!rawText) \{\cb1 \
\cb2 \'a0 return [\{ json: \{ formatted_text: "No content available." \} \}];\cb1 \
\cb2 \}\cb1 \
\
\cb2 let formattedText = rawText;\cb1 \
\
\cb2 // 2. CRITICAL FIX: Convert literal escaped "\\n" characters into REAL newlines\cb1 \
\cb2 // This solves the "clumping" issue seen in your screenshot.\cb1 \
\cb2 formattedText = formattedText.replace(/\\\\n/g, '\\n');\cb1 \
\
\cb2 // 3. Add extra spacing before headers\cb1 \
\cb2 // Any text wrapped in **bold** gets a double newline before it to create a paragraph break.\cb1 \
\cb2 formattedText = formattedText.replace(/\\*\\*(.*?)\\*\\*/g, '\\n\\n$1');\cb1 \
\
\cb2 // 4. Format Numbered Lists (1., 2.)\cb1 \
\cb2 // Forces them onto a new line so they stack vertically.\cb1 \
\cb2 formattedText = formattedText.replace(/(\\d+\\.)/g, '\\n$1');\cb1 \
\
\cb2 // 5. Format Bullet Lists (- or *)\cb1 \
\cb2 // Forces them onto a new line with a nice indented dot.\cb1 \
\cb2 formattedText = formattedText.replace(/(\\n|^)\\s*[-*]\\s+/g, '\\n \'a0 \'95 ');\cb1 \
\
\cb2 // 6. Clean up: Remove any triple newlines created by the steps above\cb1 \
\cb2 formattedText = formattedText.replace(/\\n\{3,\}/g, '\\n\\n');\cb1 \
\
\cb2 // 7. Return the clean text in a new field called 'formatted_text'\cb1 \
\cb2 return [\cb1 \
\cb2 \'a0 \{\cb1 \
\cb2 \'a0 \'a0 json: \{\cb1 \
\cb2 \'a0 \'a0 \'a0 formatted_text: formattedText.trim()\cb1 \
\cb2 \'a0 \'a0 \}\cb1 \
\cb2 \'a0 \}\cb1 \
\cb2 ];}